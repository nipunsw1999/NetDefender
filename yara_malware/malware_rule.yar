rule Malware_Image_Detection {
    meta:
        author = "Nipun"
        description = "Detects potential malware hidden in image files"
        date = "2025-02-17"
        version = "1.0"

    strings:
        // Detect suspicious file headers (altered PNG/JPG structure)
        $png_header = { 89 50 4E 47 0D 0A 1A 0A }
        $jpg_header = { FF D8 FF }
        
        // Detect embedded suspicious scripts inside image files
        $php_payload = "<?php"
        $js_payload = "<script>"
        $powershell = "powershell.exe"
        $bat_script = ".bat"
        
        // Detect common malware payload patterns
        $exe_magic = { 4D 5A }  // "MZ" header of Windows executables
        $stego_marker = "stegomalware"
        $compressed_payload = { 1F 8B 08 } // GZIP compressed data

    condition:
        (any of ($png_header, $jpg_header)) and  // Ensure it's an image file
        (any of ($php_payload, $js_payload, $powershell, $bat_script, $exe_magic, $stego_marker, $compressed_payload))
}
